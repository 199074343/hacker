# 比赛阶段切换操作指南

## 快速开始

### 使用一键脚本切换阶段

```bash
# 切换到投资期（11月14日 0:00）
python3 switch_stage.py investment

# 切换到结束期（11月14日 18:00）
python3 switch_stage.py ended
```

## 详细步骤

### 11月14日 0:00 - 切换到投资期

**执行命令：**
```bash
python3 switch_stage.py investment
```

**预期输出：**
```
============================================================
  比赛阶段切换工具
============================================================
目标阶段: 投资期 (investment)
时间范围: 11月14日0:00 - 18:00
============================================================

🔄 正在切换到 投资期 (investment)...
✅ 飞书配置更新成功
🔄 清除后端缓存...
✅ 缓存清除成功
🔄 验证阶段切换...
✅ 验证成功！当前阶段: 投资期 (investment)
   时间: 11月14日0:00 - 18:00
   可投资: 是

============================================================
✅ 阶段切换完成！
============================================================

📋 注意事项:
  - 投资人现在可以进行投资
  - UV数据继续同步
  - 排名已切换为加权排名（UV 40% + 投资额 60%）

⏰ 下次操作提醒:
  - 11月14日 18:00 执行: python3 switch_stage.py ended
```

**验证切换成功：**
访问 https://hackathon.gaodun.com，检查：
- 投资按钮是否可用
- 排名是否已切换为加权排名

---

### 11月14日 18:00 - 切换到结束期

**执行命令：**
```bash
python3 switch_stage.py ended
```

**预期输出：**
```
============================================================
  比赛阶段切换工具
============================================================
目标阶段: 活动结束 (ended)
时间范围: 11月14日18:00之后
============================================================

🔄 正在切换到 活动结束 (ended)...
✅ 飞书配置更新成功
🔄 清除后端缓存...
✅ 缓存清除成功
🔄 验证阶段切换...
✅ 验证成功！当前阶段: 活动结束 (ended)
   时间: 11月14日18:00之后
   可投资: 否

============================================================
✅ 阶段切换完成！
============================================================

📋 注意事项:
  - 投资功能已关闭
  - UV数据同步已停止
  - 排名已固化，不再变化

🎉 比赛已结束！
```

**验证切换成功：**
访问 https://hackathon.gaodun.com，检查：
- 投资按钮是否已禁用
- 排名是否已固化

---

## 手动操作步骤（备用方案）

如果脚本无法使用，可以手动操作：

### 1. 更新飞书配置

访问飞书多维表格配置表，找到 `current_stage` 配置项，修改配置值为：
- 投资期: `investment`
- 结束期: `ended`

### 2. 清除后端缓存

```bash
curl -X POST https://hackathon-backend.gaodun.com/api/hackathon/cache/clear
```

### 3. 验证切换结果

```bash
curl https://hackathon-backend.gaodun.com/api/hackathon/stage
```

---

## 操作时间表

| 时间 | 操作 | 命令 | 负责人 |
|------|------|------|--------|
| 11月14日 0:00 | 切换到投资期 | `python3 switch_stage.py investment` | _____ |
| 11月14日 18:00 | 切换到结束期 | `python3 switch_stage.py ended` | _____ |

---

## 常见问题

### Q: 脚本执行失败怎么办？
A: 使用手动操作步骤，或检查网络连接和飞书配置是否正确。

### Q: 切换后前端没有变化？
A: 刷新浏览器页面，清除浏览器缓存（Ctrl+Shift+R / Cmd+Shift+R）。

### Q: 如何查看当前阶段？
A: 执行 `curl https://hackathon-backend.gaodun.com/api/hackathon/stage`

### Q: 是否需要重启后端服务？
A: 不需要，脚本会自动清除缓存。

---

## 联系方式

如有问题，请联系技术负责人。
